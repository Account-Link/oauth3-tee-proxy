{% macro plugin_info() %}
<div class="plugin-info">
    <h3>Twitter Plugin</h3>
    <p>The Twitter plugin allows you to:</p>
    <ul>
        <li>Connect to Twitter using auth cookies or OAuth</li>
        <li>Make API calls to Twitter V1 endpoints</li>
        <li>Execute GraphQL queries against Twitter's internal API</li>
        <li>Post tweets, like, retweet, and more</li>
    </ul>
</div>
{% endmacro %}

{% macro account_management(twitter_accounts, account_oauth_status={}) %}
{% if twitter_accounts and twitter_accounts|length > 0 %}
    <ul class="account-list plugin-account-list">
        {% for account in twitter_accounts %}
            <li class="account-item" data-twitter-id="{{ account.twitter_id }}">
                <div class="account-info">
                    {% if account.profile_image_url %}
                    <div class="account-avatar">
                        <img src="{{ account.profile_image_url }}" alt="{{ account.username or 'Twitter User' }}" class="avatar">
                    </div>
                    {% endif %}
                    <div class="account-details">
                        {% if account.display_name %}
                        <div class="display-name">{{ account.display_name }}</div>
                        {% endif %}
                        
                        {% if account.username %}
                        <div class="username">
                            <a href="https://twitter.com/{{ account.username }}" target="_blank">@{{ account.username }}</a>
                        </div>
                        {% endif %}
                        
                        <div class="twitter-id">ID: {{ account.twitter_id }}</div>
                        <div class="added-date">Added: {{ account.created_at.strftime('%Y-%m-%d') }}</div>
                        
                        <div class="auth-methods">
                            {% if account.twitter_cookie %}
                                <span class="auth-badge cookie-auth">Cookie Auth</span>
                            {% endif %}
                            
                            {% if account_oauth_status and account_oauth_status.get(account.twitter_id, false) %}
                                <span class="auth-badge oauth-auth">OAuth Auth</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="account-actions">
                    <button class="button delete-button" onclick="deleteTwitterAccount('{{ account.twitter_id }}')">Delete</button>
                </div>
            </li>
        {% endfor %}
    </ul>
    
    <style>
        .auth-methods {
            margin-top: 5px;
        }
        
        .auth-badge {
            display: inline-block;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }
        
        .cookie-auth {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }
        
        .oauth-auth {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }
    </style>
{% else %}
    <p>No Twitter accounts linked yet.</p>
{% endif %}

<script>
async function deleteTwitterAccount(twitterId) {
    if (!confirm('Are you sure you want to delete this Twitter account?')) return;
    
    try {
        const response = await fetch(`/twitter/accounts/${twitterId}`, {
            method: 'DELETE'
        });
        
        if (response.ok || response.redirected) {
            window.location.href = response.redirected ? response.url : '/dashboard';
        } else {
            const error = await response.json();
            alert(error.detail || 'Failed to delete Twitter account');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error deleting Twitter account');
    }
}
</script>
{% endmacro %}

{% macro dashboard_actions() %}
<div class="plugin-actions">
    <a href="/twitter/accounts/manage" class="button" style="background-color: #1DA1F2; margin-right: 10px;">Manage Twitter Accounts</a>
    <a href="/twitter/graphql/playground" class="button" style="background-color: #1DA1F2;">Twitter GraphQL Playground</a>
</div>
{% endmacro %}